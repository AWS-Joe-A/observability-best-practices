# アラーム

アラームとは、プローブ、モニター、または特定のしきい値を超えたり下回ったりする値の変化の状態を指します。簡単な例としては、ディスクがいっぱいになったときや Web サイトがダウンしたときにメールを送信するアラームがあります。より高度なアラームは完全にプログラムで駆動されており、オートスケーリングやサーバークラスタの作成などの複雑な相互作用を実現するために使用されます。

ただし、ユースケースに関係なく、アラームはメトリクスの現在の*状態*を示します。この状態は、システムによって `OK`、`WARNING`、`ALERT`、`NO DATA` のいずれかになります。

アラームはある期間この状態を反映し、時系列の上に構築されます。したがって、それらは時系列*から*導出されます。下のグラフは、2つのアラームを示しています。1つは警告しきい値のアラームで、もう1つはこの時系列全体の平均値を示すアラームです。このグラフが示す通り、トラフィック量が定義された値を下回ると、警告しきい値のアラームが違反状態になる必要があります。

![時系列と 2 つのアラーム](../images/cwalarm2.png)

!!! info
	アラームの目的は、アクションをトリガーすること(人間またはプログラムによる)、または情報提供(しきい値の違反)のいずれかです。アラームはメトリクスのパフォーマンスに関する洞察を提供します。

## アクション可能なものに対してアラートを設定する

アラート疲労とは、人々が多すぎるアラートを受け取り、それらを無視することを学習してしまうことです。これは、適切に監視されているシステムの兆候ではありません。むしろ、このようなことは反パターンです。

!!! success
	アクション可能なものに対してのみアラームを作成し、常に[目的](../../guides/#monitor-what-matters)から逆算で考えるべきです。

例えば、高速なレスポンスタイムが必要な Web サイトを運用している場合は、レスポンスタイムが特定のしきい値を超えたときにアラートが配信されるように設定します。また、パフォーマンスの低下が高い CPU 使用率と関連していることを特定した場合は、このデータポイントに対して問題が発生する*前に* 予防的にアラートを設定します。ただし、環境内の*すべての* CPU 使用率にアラートを設定する必要はなく、*目的達成を危険にさらさない*場合には不要です。

!!! success
	アラームがアラートを必要とせず、自動プロセスをトリガーしない場合、アラートを受信する必要はありません。不要なアラームから通知を削除する必要があります。

## 「すべてOKアラーム」に注意

同様に、一般的なパターンとして、オペレーターが絶え間なくアラートを受信することに慣れてしまい、突然静かになったときだけ気づく「すべてOKアラーム」があります。これは非常に危険な運用モードであり、[オペレーショナルエクセレンス](../../faq/#what-is-operational-excellence)に反するパターンです。 

!!! warning
	「すべてOKアラーム」は通常、人間による解釈が必要です。これにより、セルフヒーリングアプリケーションなどのパターンが不可能になります[^1]。

## 集約によるアラーム疲労の緩和

オブザーバビリティは技術的な問題ではなく、*人間*の問題です。そのため、アラーム戦略は新たなアラームの作成よりもアラームの削減に焦点を当てるべきです。テレメトリ収集を実装するにつれて、環境からのアラートが自然に増えていきます。ただし、[アクション可能なものだけをアラートの対象とする](../../signals/alarms/#alert-on-things-that-are-actionable)ことには注意が必要です。アラートの原因となった条件がアクション可能でない場合、それを報告する必要はありません。

これは次の例で最もよく示されています。バックエンドに単一のデータベースを使用する 5 つの Web サーバーがある場合、データベースがダウンしたときに Web サーバーに何が起こるでしょうか? 多くの人の答えは、少なくとも *6 つの* アラートが発生するというものです - データベースの *1 つ* と Web サーバーの *5 つ* のアラートです!

![6つのアラーム](../images/alarm3.png)

しかし、配信する意味のあるアラートは2つだけです。

1. Webサイトがダウンしている
2. データベースが原因である

![2つのアラーム](../images/alarm4.png)

!!! success
    アラートを集約することで、人々が理解しやすくなり、実行手順書や自動化の作成が容易になります。

## 既存の ITSM とサポートプロセスを利用する

モニタリングとオブザーバビリティのプラットフォームに関係なく、それらは現在のツールチェーンと統合する必要があります。

!!! success
	アラートからこれらのツールへのプログラムによる統合を使用して、トラブルチケットとイシューを作成し、人為的な作業を削減し、プロセスを合理化します。

これにより、[DORA メトリクス](https://en.wikipedia.org/wiki/DevOps)などの重要な運用データを導出できます。


[^1]: このパターンの詳細については、 https://aws.amazon.com/blogs/apn/building-self-healing-infrastructure-as-code-with-dynatrace-aws-lambda-and-aws-service-catalog/ を参照してください。
