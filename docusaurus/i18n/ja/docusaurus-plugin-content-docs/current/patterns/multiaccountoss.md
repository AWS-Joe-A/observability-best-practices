# AWS オープンソースサービスを使用したクロスアカウントモニタリング




## はじめに

最近のクラウド環境は、複数のアカウントにまたがり、オンプレミスのインフラストラクチャも含むことが多く、複雑な監視の課題を生み出しています。
これらの課題に対処するため、AWS サービスと業界標準のツールを使用した高度な監視アーキテクチャを実装することができます。
このアーキテクチャにより、多様な環境全体を包括的に可視化し、効率的な管理と迅速な問題解決を促進します。



## コアコンポーネント

この監視ソリューションの中心にあるのは AWS Distro for OpenTelemetry (ADOT) で、様々なソースからのメトリクスを一元的に収集するポイントとして機能します。ADOT は専用の中央 AWS アカウントにデプロイされ、監視インフラストラクチャのハブを形成します。この中央デプロイにより、データの集約と処理が効率化されます。

Amazon Managed Service for Prometheus も重要なコンポーネントで、収集されたメトリクスを保存するためのスケーラブルで管理されたタイムシリーズデータベースを提供します。このサービスにより、自己管理型の Prometheus インスタンスが不要になり、運用オーバーヘッドが削減され、メトリクスデータの高可用性が確保されます。

可視化と分析のために、Grafana がアーキテクチャに統合されています。Grafana は Amazon Managed Service for Prometheus に接続し、強力なクエリ機能とカスタマイズ可能なダッシュボードを提供します。これにより、チームは収集されたメトリクスに基づいて洞察力のある可視化を作成し、アラートを設定することができます。

![multiaccount AMP](./images/multiaccountoss.png)
*図 1：AWS オープンソースサービスを使用したマルチアカウント監視*




## データ収集とフロー

このアーキテクチャは、監視対象アカウントと呼ばれる複数の AWS アカウントからのデータ収集をサポートしています。
これらのアカウントは、OpenTelemetry プロトコル (OTLP) を使用してメトリクスを中央の ADOT インスタンスにエクスポートします。
この標準化されたアプローチにより、データ形式の一貫性が確保され、新しいアカウントを監視設定に容易に統合できます。

オンプレミスのインフラストラクチャもこの監視ソリューションに組み込まれています。
これらのシステムは、セキュアな HTTPS POST リクエストを使用してメトリクスデータを中央の ADOT インスタンスに送信します。
この方法により、レガシーシステムやクラウド以外のシステムを全体的な監視戦略に含めることができ、IT 環境全体の真に包括的な視点を提供します。

データが中央の ADOT インスタンスに到達すると、処理されて Prometheus リモートライトプロトコルを使用して Amazon Managed Service for Prometheus に転送されます。
この手順により、収集されたすべてのメトリクスが時系列データに最適化された形式で保存され、効率的なクエリと分析が可能になります。



## 利点と考慮事項

このアーキテクチャには、いくつかの重要な利点があります。多様なソースからのメトリクスを一元的に表示できるため、複雑な環境を包括的に監視することができます。マネージドサービスを使用することで、チームの運用負担が軽減され、インフラストラクチャの保守ではなく分析に集中できます。さらに、このアーキテクチャは非常にスケーラブルで、監視対象システムの数と収集されるメトリクスの量の両方の増加に対応できます。

しかし、このアーキテクチャを実装する際には、考慮すべき点もあります。ソリューションの一元化された性質により、中央アカウントの監視インフラストラクチャが重要になるため、高可用性と災害復旧のための慎重な計画が必要です。また、アカウント間のデータ転送やマネージドサービスの使用に関連するコストの影響もあるかもしれません。これらは予算決定の際に考慮する必要があります。

セキュリティも重要な側面です。クロスアカウントのメトリクス収集を可能にするために、適切な IAM ロールと権限を設定する必要があります。オンプレミスシステムについては、監視データの整合性と機密性を維持するために、安全で認証された HTTPS 接続を確保することが重要です。



## 結論

この高度な AWS クラウドモニタリングアーキテクチャは、複雑なマルチアカウントおよびハイブリッドインフラストラクチャ環境を持つ組織に対して、堅牢なソリューションを提供します。
AWS マネージドサービスと OpenTelemetry や Grafana などの業界標準ツールを活用することで、スケーラブルで強力なモニタリングソリューションを実現します。
効果的に実装するには慎重な計画と管理が必要ですが、包括的な可視性と一元化されたモニタリングのメリットにより、最新のクラウドネイティブおよびハイブリッド環境にとって価値のあるアプローチとなります。

このアーキテクチャの柔軟性により、さまざまな組織のニーズに適応し、モニタリング要件の変化に応じて進化することができます。
クラウド環境の複雑さが増す中、このような一元化された包括的なモニタリングソリューションは、すべてのインフラストラクチャコンポーネントにわたって運用の優位性を維持し、最適なパフォーマンスを確保するために、ますます重要になっています。
