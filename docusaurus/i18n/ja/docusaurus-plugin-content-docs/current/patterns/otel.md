# OpenTelemetry によるオブザーバビリティ

OpenTelemetry はオープンソースでベンダー非依存のオブザーバビリティフレームワークです。ログ、メトリクス、トレースなどのテレメトリデータを収集・エクスポートする標準的な方法を提供します。OpenTelemetry を活用することで、組織はベンダーに依存せずに包括的なオブザーバビリティパイプラインを実装し、将来にわたってオブザーバビリティ戦略を確保できます。

## OpenTelemetry を使ったメトリクスとインサイトの収集

1. **インストルメンテーション**: OpenTelemetry を使う最初のステップは、OpenTelemetry ライブラリまたは SDK を使ってアプリケーションやサービスにインストルメンテーションを行うことです。これらのライブラリは、アプリケーションコードからメトリクス、トレース、ログなどのテレメトリデータを自動的に取得してエクスポートします。

2. **メトリクス収集**: OpenTelemetry は、アプリケーションからメトリクスを収集してエクスポートする標準的な方法を提供します。これらのメトリクスには、システムメトリクス (CPU、メモリ、ディスク使用量)、アプリケーションレベルのメトリクス (リクエスト率、エラー率、レイテンシー)、アプリケーションに固有のカスタムビジネスメトリクスが含まれます。

3. **分散トレーシング**: OpenTelemetry は分散トレーシングをサポートしており、分散システムを通じてリクエストやオペレーションをトレースすることができます。これにより、リクエストのエンドツーエンドのフローに関する貴重な洞察が得られ、ボトルネックの特定やパフォーマンスの問題のトラブルシューティングが可能になります。

4. **ロギング**: OpenTelemetry の主な焦点はメトリクスとトレースですが、ログデータを取得してエクスポートするための構造化ロギング API も提供しています。これにより、ログがその他のテレメトリデータと関連付けられ、システムの動作を包括的に把握できます。

5. **エクスポーター**: OpenTelemetry は、さまざまなエクスポーターをサポートしており、テレメトリデータを異なるバックエンドやオブザーバビリティプラットフォームに送信できます。一般的なエクスポーターには、Prometheus、Jaeger、Zipkin、AWS CloudWatch、Azure Monitor、Google Cloud Operations などのクラウドネイティブオブザーバビリティソリューションがあります。

6. **データ処理と分析**: テレメトリデータがエクスポートされると、オブザーバビリティプラットフォーム、モニタリングツール、またはカスタムデータ処理パイプラインを活用して、収集されたメトリクス、トレース、ログを分析および可視化できます。この分析により、システムパフォーマンスの洞察、ボトルネックの特定、トラブルシューティングやルート原因分析が可能になります。
![Otel](./images/otel.png)
*図1: ADOT と FluentBit を使って EKS クラスターからオブザーバビリティシグナルを送信*
<!--Ref: https://aws.amazon.com/blogs/architecture/amazon-cloudwatch-insights-for-amazon-eks-on-ec2-using-aws-distro-for-opentelemetry-helm-charts/-->

## OpenTelemetry を使用するメリット

1. **ベンダー中立性**: OpenTelemetry はオープンソースでベンダー中立のプロジェクトです。これにより、オブザーバビリティ戦略が特定のベンダーやプラットフォームに縛られることがありません。この柔軟性により、必要に応じてオブザーバビリティのバックエンドを切り替えたり、複数のソリューションを組み合わせたりできます。

2. **標準化**: OpenTelemetry は、テレメトリデータの収集と出力を標準化した方法を提供します。これにより、データ形式の統一とさまざまなコンポーネントやシステム間での相互運用性が可能になります。

3. **将来性**: OpenTelemetry を採用することで、オブザーバビリティ戦略の将来性を確保できます。プロジェクトが進化し、新機能や統合が追加されても、既存の計装を大幅なコード変更なしで簡単に更新できます。

4. **包括的なオブザーバビリティ**: OpenTelemetry は、メトリクス、トレース、ログなど複数のテレメトリシグナルをサポートしているため、システムの動作とパフォーマンスを包括的に把握できます。

5. **エコシステムとコミュニティサポート**: OpenTelemetry には、統合、ツール、活発なコントリビューターコミュニティが存在し、継続的な開発とサポートが期待できます。

OpenTelemetry を活用したオブザーバビリティにより、組織はシステムの深い洞察を得ることができ、プロアクティブなモニタリング、効率的なトラブルシューティング、データに基づく意思決定が可能になります。また、オブザーバビリティ戦略の柔軟性とベンダー非依存性を維持できます。
