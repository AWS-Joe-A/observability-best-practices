# ADOT オブザーバビリティパイプライン

オブザーバビリティパイプラインは、さまざまなソースからオブザーバビリティデータを収集、管理、分析するために連携する複数のコンポーネントで構成されています。

## EKS クラスター

EKS (Elastic Kubernetes Service) クラスターは、オブザーバビリティパイプラインの主要コンポーネントをホストします。

### ADOT Operator Helm チャートをインストールする

ADOT (AWS Distro for OpenTelemetry) Operator は Helm チャートを使ってインストールされます。オブザーバビリティパイプラインコンポーネントのデプロイと設定を管理します。

### ユーザー設定のコレクター

ユーザー設定のコレクターはオペレーターによって管理され、以下のコンポーネントで構成されています。

- Deployment としてのコレクター: コレクターは Kubernetes の Deployment としてデプロイされ、高可用性とスケーラビリティが確保されます。
- Collector-0、Collector-1、Collector-2: 複数のコレクターインスタンスがデプロイされ、インカミングのオブザーバビリティデータを処理します。それらは協調して負荷を分散し、信頼性の高いデータ収集を実現します。

![OTEL pipeline](./images/otelpipeline.png)
*図 1: OpenTelemetry パイプライン*

### 永続ボリューム

永続ボリュームは、収集したオブザーバビリティデータを保存するために使用されます。データの永続性を確保し、長期的な保存と分析を可能にします。

### Kubernetes ノード

Kubernetes ノードは、アプリケーション Pod とサイドカーとしてのコレクターをホストします。

- アプリケーションコンテナ: アプリケーションコンテナは実際のアプリケーションコードを実行し、オブザーバビリティデータを生成します。
- サイドカーとしてのコレクター: コレクターはアプリケーションコンテナと並んでサイドカーコンテナとして実行されます。アプリケーションによって生成されたオブザーバビリティデータを収集します。

## スクレイピングターゲット

オブザーバビリティパイプラインは、以下のようなさまざまなスクレイピングターゲットからデータを収集します。

- トレース/メトリクスのスクレイピング: パイプラインは、アプリケーションとインフラストラクチャコンポーネントからトレースとメトリクスをスクレイピングします。

## AWS Prometheus Remote Write Exporter

AWS Prometheus Remote Write Exporter は、収集したオブザーバビリティデータを AWS サービスにエクスポートするために使用されます。

## AWS CloudWatch EMF Exporter

AWS CloudWatch EMF (Embedded Metric Format) Exporter は、メトリクスを AWS CloudWatch にエクスポートするために使用されます。

## AWS X-Ray Tracing Exporter

AWS X-Ray Tracing Exporter は、分散トレーシングとパフォーマンス分析のために、トレーシングデータを AWS X-Ray にエクスポートするために使用されます。

オブザーバビリティパイプラインは、スクレイプターゲットからデータを収集し、コレクターを使ってデータを処理し、さらなる分析と可視化のために、さまざまな AWS サービスにデータをエクスポートします。

## ADOT によるメトリクスとインサイトの収集

1. **インストルメンテーション**: OpenTelemetry と同様に、ADOT はアプリケーションとサービスをインストルメント化するためのライブラリと SDK を提供し、メトリクス、トレース、ログなどのテレメトリデータを収集します。

2. **メトリクス収集**: ADOT は、システムレベルとアプリケーションレベルのメトリクスを収集・エクスポートできます。AWS サービスメトリクスも含まれ、リソース使用率とアプリケーションのパフォーマンスに関する洞察を得られます。

3. **分散トレーシング**: ADOT は、AWS サービス、コンテナ、オンプレミス環境にわたる分散トレーシングを可能にし、リクエストやオペレーションをエンドツーエンドでトレースできます。

4. **ログ**: ADOT は構造化ログをサポートし、ログデータを他のテレメトリシグナルと関連付けることで、包括的なオブザーバビリティを実現します。

5. **AWS サービス統合**: ADOT は AWS X-Ray、AWS CloudWatch、Amazon Managed Service for Prometheus、AWS Distro for OpenTelemetry Operator などの AWS サービスとの密接な統合を提供し、AWS エコシステム内でシームレスなテレメトリ収集と分析を可能にします。

6. **自動インストルメンテーション**: ADOT は、人気のあるフレームワークやライブラリに対する自動インストルメンテーション機能を提供し、既存のアプリケーションのインストルメンテーションプロセスを簡素化します。

7. **データ処理と分析**: ADOT によって収集されたテレメトリデータは、AWS X-Ray、Amazon Managed Service for Prometheus、AWS CloudWatch などの AWS オブザーバビリティサービスにエクスポートできます。AWS ネイティブの分析とビジュアライゼーションツールを活用できます。

## ADOT を使用するメリット

1. **AWS ネイティブな統合**: ADOT は AWS サービスとインフラストラクチャとのシームレスな統合を目的として設計されており、AWS エコシステム内で一貫したオブザーバビリティ体験を提供します。

2. **パフォーマンスとスケーラビリティ**: ADOT はパフォーマンスとスケーラビリティを最適化しており、大規模な AWS 環境でのテレメトリ収集と分析を効率的に行えます。

3. **セキュリティとコンプライアンス**: ADOT は AWS のセキュリティベストプラクティスに準拠し、さまざまな業界標準に準拠しているため、セキュアでコンプライアンスに準拠したオブザーバビリティ実践が可能です。

4. **AWS サポート**: AWS がサポートする配布版として、ADOT は AWS の広範な文書、サポートチャネル、OpenTelemetry プロジェクトへの長期的なコミットメントの恩恵を受けます。

## OpenTelemetry と ADOT の違い

ADOT と OpenTelemetry は多くのコア機能を共有していますが、いくつかの重要な違いがあります。

1. **AWS 統合**: ADOT は AWS 環境専用に設計されており、AWS サービスとの密接な統合を提供しますが、OpenTelemetry はベンダー中立的なプロジェクトです。

2. **AWS 最適化**: ADOT は AWS 環境内でのパフォーマンス、スケーラビリティ、セキュリティに最適化されており、AWS ネイティブのサービスとベストプラクティスを活用しています。

3. **AWS サポート**: ADOT は公式の AWS サポート、ドキュメント、長期的なコミットメントの恩恵を受けますが、OpenTelemetry はコミュニティサポートに依存しています。

4. **AWS 固有の機能**: ADOT には AWS サービス向けの自動インストルメンテーションや AWS 固有の機能が含まれていますが、OpenTelemetry は汎用的なオブザーバビリティに焦点を当てています。

5. **ベンダー中立性**: OpenTelemetry はベンダー中立的なプロジェクトであり、さまざまなオブザーバビリティプラットフォームと統合できますが、ADOT は主に AWS のオブザーバビリティサービスに焦点を当てています。

ADOT を活用することで、組織は AWS エコシステム内で包括的なオブザーバビリティを実現でき、AWS ネイティブの統合、最適化されたパフォーマンス、AWS サポートの恩恵を受けながら、OpenTelemetry の機能とコミュニティの貢献を活用する柔軟性も維持できます。
