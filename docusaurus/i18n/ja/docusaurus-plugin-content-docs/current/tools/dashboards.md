# ダッシュボード

ダッシュボードは、オブザーバビリティソリューションの重要な部分です。ダッシュボードを使用すると、データの視覚化を行うことができます。ダッシュボードを使えば、データの履歴を確認したり、関連するデータと併せて確認したりできます。また、コンテキストを提供することもできます。ダッシュボードは、全体像を理解するのに役立ちます。

多くの人がデータを収集し、アラームを作成するところまでは行いますが、そこで止まってしまいます。しかし、アラームは特定の時点のデータしか示しておらず、通常は単一のメトリクスまたは少量のデータに対してのみ設定されます。一方、ダッシュボードを使えば、時間の経過に伴うデータの振る舞いを確認できます。

![サンプルダッシュボード](../images/dashboard1.png)

## 実践的な例: 高 CPU のアラームを考える
マシンが所望以上の CPU で動作していることがわかっています。対応が必要か、どのくらい早く対応する必要があるかを考えましょう。判断の助けになるものは何でしょうか?

* このインスタンス/アプリケーションの通常の CPU 使用率はどのようなものですか?
* これは一時的なスパイクなのか、CPU 使用率が上昇傾向にあるのでしょうか?
* パフォーマンスに影響を与えていますか? そうでない場合、影響が出るまでにどのくらいの時間がかかりますか?
* これは定期的に発生することですか? そして、通常は自然に回復しますか?

### データの履歴を確認する

CPU の履歴を示すタイムチャートを含むダッシュボードを考えてみましょう。この単一のメトリクスでも、スパイクなのか上昇傾向なのかを確認できます。また、上昇の速度も確認できるため、対応の優先度を判断できます。

### ワークフローへの影響を確認する

しかし、この機械は何をしているのでしょうか? 全体の文脈でどの程度重要なのでしょうか? レスポンス時間、スループット、エラー、または他の指標でワークフローのパフォーマンスを可視化することを想像してみてください。そうすれば、高い CPU 使用率がこのインスタンスがサポートしているワークフローやユーザーに影響を与えているかどうかを確認できます。

### アラームの履歴を確認する

過去 1 か月間でアラームがどのくらいの頻度で発生したかを示す可視化を追加し、それを過去のデータと組み合わせて、これが定期的に発生するものかどうかを確認することを検討してください。たとえば、バックアップジョブがスパイクの原因となっているのでしょうか。再発パターンを知ることで、根本的な問題を理解し、アラームが完全に再発しないようにするための長期的な対策を立てることができます。

### コンテキストを追加する

最後に、ダッシュボードにいくつかのコンテキストを追加します。このダッシュボードが存在する理由、関連するワークフロー、問題が発生した場合の対処方法、ドキュメントへのリンク、連絡先などの簡単な説明を含めます。

info
    これで、ダッシュボードの使用者が何が起こっているのかを把握し、影響を理解し、適切なデータに基づいた意思決定とその緊急性を判断できる *ストーリー* ができました。


### すべてを一度に可視化しようとしないでください

私たちは多くの場合、アラーム疲労について話します。識別可能なアクションや優先順位がない多くのアラームは、チームを圧倒し、非効率につながる可能性があります。アラームは、重要で対処可能なものに対してのみ設定するべきです。

一方、ダッシュボードはより柔軟です。ダッシュボードはアラームのように注意を引くものではないため、まだ重要かどうか確信がない事柄や、探索を支援する事柄を可視化する自由度が高くなります。ただし、行き過ぎにも注意が必要です。あらゆるものに良すぎるということはあります。

ダッシュボードは、あなたにとって重要なものの状況を示すべきです。データの取り込み対象を決めるのと同様に、ダッシュボードに関しても何が重要かを考える必要があります。
ダッシュボードを設計する際は、以下のことを考えてください。

* 誰がこのダッシュボードを見るのか?
    * 彼らの背景知識は何か?
    * どの程度のコンテキストが必要か?
* 彼らは何を知りたいのか?
* このデータを見た結果、どのようなアクションを取るのか?

tip
    ダッシュボードのストーリーをどのように構築し、どの程度の情報を含めるべきか分からない場合があります。そのような場合、ダッシュボードの設計はどこから始めればよいでしょうか? *KPI 主導* または *インシデント主導* の 2 つの方法を見てみましょう。


#### ダッシュボードの設計: KPI 主導

これを理解する1つの方法は、KPI から逆算することです。これは通常、非常にユーザー主導のアプローチです。
[レイアウト](#layout)については、通常、上から下に作業し、ダッシュボードの下方に移動するか、下位レベルのダッシュボードに移動するにつれて、より詳細になります。

まず、**KPI を理解する** ことが重要です。KPI の意味を理解することで、それらをどのように可視化したいかを決めることができます。
多くの KPI は単一の数値として表示されます。たとえば、特定のワークフローを正常に完了する顧客の割合と、その所要時間はどのくらいですか? しかし、どの期間でしょうか? 週単位で平均すれば KPI を満たすかもしれませんが、その中に基準を下回る短い期間がある可能性があります。これらの基準違反は重要ですか? 顧客体験に影響しますか? もしそうであれば、KPI を確認するために異なる期間と時間チャートを検討する必要があるかもしれません。また、誰もが詳細を見る必要はないかもしれないので、KPI の内訳を別のダッシュボードに移し、別の対象者向けにすることを検討してください。

次に、**それらの KPI に何が寄与しているか?** を考えます。それらのアクションが発生するためには、どのようなワークフローが実行されている必要がありますか? 測定できますか?

主要なコンポーネントを特定し、それらのパフォーマンスの可視化を追加します。KPI が基準を下回った場合、ワークフローのどこに主な影響があるかを素早く確認できるはずです。

さらに掘り下げることができます - それらのワークフローのパフォーマンスに影響を与えるものは何ですか? 詳細レベルを決める際は、対象者を忘れずに検討してください。

例えば、注文数の KPI を持つ電子商取引システムを考えてみましょう。
注文が行われるためには、ユーザーが次のアクションを実行できる必要があります: 製品を検索する、カートに追加する、配送先の詳細を入力する、注文を支払う。
これらのワークフローごとに、主要なコンポーネントが機能していることを確認することを検討するかもしれません。例えば、RUM や Synthetics を使用してアクションの成功率を取得し、ユーザーが問題の影響を受けているかどうかを確認します。各アクションのパフォーマンス(スループット、レイテンシ、失敗したアクションの割合など)が期待通りかどうかを測定することを検討するかもしれません。基盤となるインフラストラクチャの測定値を確認し、パフォーマンスに影響を与える可能性があるものを特定することも検討できます。

ただし、すべての情報を同じダッシュボードに入れないでください。再び、ユーザーの対象者を考慮してください。

info
    ドリルダウンを可能にし、適切なユーザーに適切なコンテキストを提供するレイヤー化されたダッシュボードを作成してください。


#### インシデント駆動型のダッシュボードを設計する

多くの人にとって、インシデント解決はオブザーバビリティの主要な動機付けとなります。ユーザーやオブザーバビリティアラームから問題が通知され、迅速に修正を行い、場合によっては問題の根本原因を特定する必要があります。

info
    最近のインシデントを見直してみましょう。共通のパターンはありますか? 会社にとって最も影響が大きかったのはどれですか? 繰り返し発生するものはありますか?


この場合、インシデントの深刻度を理解し、根本原因を特定し、インシデントを修正しようとしている人のためのダッシュボードを設計します。

具体的なインシデントを振り返ってみましょう。

* インシデントが報告通りであることをどのように確認しましたか?
    * 何を確認しましたか? エンドポイント? エラー?
* 影響範囲を理解し、したがって問題の優先度をどのように判断しましたか?
* 問題の原因を探るために何を見ましたか?

Application Performance Monitoring (APM) が役立ちます。[Synthetics](../tools/synthetics/) はエンドポイントやワークフローの定期的なベースラインテストに、[RUM](../tools/rum/) は実際の顧客体験の把握に使えます。このデータを使って、どのワークフローがどの程度影響を受けているかを迅速に可視化できます。

時間の経過に伴うエラー数と上位エラーを示す可視化は、適切な領域に集中し、エラーの詳細を示すのに役立ちます。ここではログデータを使用し、エラーコードと理由を動的に可視化することが多くなります。

フィルタリングやドリルダウンの機能があると、できるだけ早く詳細情報にアクセスできるので便利です。オーバーヘッドが大きくならない方法を検討してください。たとえば、フィルタリングして詳細に近づけるシングルダッシュボードを用意するなどです。

### レイアウト

ダッシュボードのレイアウトも重要です。

info
    通常、ユーザーにとって最も重要な可視化は、左上に配置するか、ページナビゲーションの自然な *開始* 位置に合わせます。


レイアウトを使って物語を伝えることができます。例えば、上から下へのレイアウトを使い、下にスクロールするほど詳細が見えるようにするか、左から右に高レベルのサービスを配置し、右に行くほど依存関係を表示するなどです。

### 動的コンテンツを作成する

多くのワークロードは、需要に応じて拡大または縮小するように設計されているため、ダッシュボードもこれを考慮する必要があります。たとえば、インスタンスを Auto Scaling グループに配置し、一定の負荷に達すると追加のインスタンスが追加されるような場合です。

info
特定の ID で指定された特定のインスタンスからのデータを表示するダッシュボードでは、新しいインスタンスからのデータを確認できません。リソースとデータにメタデータを追加し、特定のメタデータ値を持つすべてのインスタンスをキャプチャするように可視化を作成します。そうすれば、実際の状態を反映することができます。


動的な可視化の別の例として、現在発生している上位 10 件のエラーを見つけ、最近の履歴でそれらがどのように振る舞ったかを確認できるようにすることが考えられます。発生する可能性のあるエラーを知らずに、テーブルやチャートを確認できるようにしたいものです。

### まず症状について考える

症状を観察する際は、ユーザーやシステムに与える影響について検討します。多くの根本原因が同じ症状を引き起こす可能性があります。これにより、未知の問題を含む、より多くの問題をキャプチャできます。原因がわかれば、低レベルのダッシュボードでは、問題の迅速な診断と修正を支援するため、それらに特化した内容になるでしょう。

tip
    先週ユーザーに影響を与えた特定の JavaScript エラーをキャプチャするのではなく、それが中断したワークフローへの *影響* をキャプチャし、最近の履歴における JavaScript エラーの上位カウントを示すか、最近の履歴で劇的に増加したエラーを示します。


### 上位/下位 N 件を使用する

ほとんどの場合、すべての運用メトリクスを同時に可視化する必要はありません。大規模な EC2 インスタンスのフリートがその良い例です。数百台のサーバーの農場全体のディスク IOPS や CPU 使用率を同時に表示する必要性や価値はありません。これにより、メトリクスを掘り下げようとするよりも、最高 (または最低) のパフォーマンスリソースを見つけるほうが時間がかかるという反パターンが生じます。

info
    ダッシュボードを使用して、任意のメトリクスの上位 10 件または 20 件を表示し、その後、この結果で明らかになった[症状](#think-about-symptoms-first-over-causes)に焦点を当ててください。

[CloudWatch メトリクス](../tools/metrics/)を使用すると、任意の時系列の上位 N 件を検索できます。たとえば、次のクエリは CPU 使用率が最も高い 20 台の EC2 インスタンスを返します。

```
SORT(SEARCH('{AWS/EC2,InstanceId} MetricName="CPUUtilization"', 'Average', 300), SUM, DESC, 10)
```

このアプローチを使用するか、[CloudWatch Metric Insights](https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/query_with_cloudwatch-metrics-insights.html) と同様の方法を使用して、ダッシュボードで上位または下位のメトリクスを特定してください。

### 閾値を視覚的に表示した KPI を示す

KPI には警告または障害の閾値を設定し、ダッシュボードではこれを水平アノテーションで示すことができます。これはウィジェット上の高水位線として表示されます。ビジネス成果やインフラストラクチャが危険にさらされている場合に、視覚的にこれを示すことで、人間のオペレーターに事前警告を与えることができます。

![水平アノテーションの画像](../images/horizontal-annotation.png)

alert{type="info"}
水平アノテーションは、適切に開発されたダッシュボードの重要な部分です。


### コンテキストの重要性

人々はデータを誤解しがちです。彼らの背景と現在のコンテキストが、データの見方に影響を与えます。

そのため、ダッシュボード内に *テキスト* を含めることが重要です。このデータは何のためで、誰向けなのか。それは何を意味するのか。アプリケーションのドキュメント、サポート担当者、トラブルシューティングドキュメントへのリンクを記載してください。また、テキスト表示を使ってダッシュボードの表示を分割することもできます。左側に配置して左右のコンテキストを設定したり、水平方向に配置してダッシュボードを垂直に分割したりできます。

alert{type="info"}
IT サポート、オペレーション当番、ビジネスオーナーへのリンクを設置すれば、問題発生時にチームが迅速に支援を求められる経路を提供できます。

alert{type="info"}
チケット発行システムへのハイパーリンクを追加するのも、ダッシュボードにとって非常に有用です。
